---
description: >
  Command to execute release of a maven project.
parameters:
  mvn_path:
    description: Specify a custom path to maven
    type: string
    default: mvn
  project_dir:
    type: string
    default: .
  settings_file:
    description: Specify a path to a custom settings file to use
    type: string
    default: "$GIT_CI_CONF_DIR/mvn/settings.xml"
  ssh_fingerprint:
    type: string
    default: 08:24:83:a8:59:c5:7d:d5:de:b3:15:bf:1a:50:0e:ca
steps:
  - add_ssh_keys:
      fingerprints:
        - "<< parameters.ssh_fingerprint >>"
  - run:
      name: Setup custom settings.xml
      command: |
        FILE="<< parameters.settings_file >>"
        if [ -f "$FILE" ]; then
          mkdir -v -p ~/.m2
          cp -v $FILE ~/.m2
        else
          echo $FILE not found
        fi
  - run:
      name: "Release project"
      environment:
        MVN_PATH: "<< parameters.mvn_path >>"
        PROJECT_DIR: << parameters.project_dir >>
      command: <<include(scripts/maven_release.sh)>>
