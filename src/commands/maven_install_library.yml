---
description: |
  Install a java library from a git repo
parameters:
  maven_command:
    type: string
    default: "clean install"
  maven_cmd_opts:
    type: string
    default: "-Dmaven.test.skip=true -Dmaven.javadoc.skip=true"
  maven_path:
    type: string
    default: "./mvnw"
  repo_branch:
    type: string
    default: ""
  repo_dir:
    type: string
    default: "/tmp"
  repo_url:
    type: string
steps:
  - when:
      condition: [ << parameters.repo_branch >> == "" ]
      steps:
        - run:
            name: Check if CIRCLE_BRANCH exists in << parameters.repo_url >>
            environment:
              REPO_URL: << parameters.repo_url >>
            command: <<include(scripts/git_check_remote_branch.sh)>>
        - run:
            name: Halt step if CIRCLE_BRANCH does not exists in << parameters.repo_url >>
            environment:
              REPO_BRANCH: << parameters.repo_branch >>
              REPO_URL: << parameters.repo_url >>
            command: |
              if [ $REMOTE_BRANCH_EXISTS == "false" ]; then
                echo "INFO: impossible to find branch ${CIRCLE_BRANCH} on ${REPO_URL} and repo_branch is not set"
                circleci-agent step halt
              fi
  - git_checkout:
      branch: << parameters.repo_branch >>
      dir: << parameters.repo_dir >>
      url: << parameters.repo_url >>
  - run:
      name: Install maven library from << parameters.repo_url >>
      environment:
        MAVEN_COMMAND: << parameters.maven_command >>
        MAVEN_CMD_OPTS: << parameters.maven_cmd_opts >>
        MAVEN_PATH: << parameters.maven_path >>
        REPO_DIR: << parameters.repo_dir >>
        REPO_URL: << parameters.repo_url >>
      command: <<include(scripts/maven_install_library.sh)>>
