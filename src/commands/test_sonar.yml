description: "Setup steps"
parameters:
  sonar_version:
    type: string
    default: "3.7.0.1746"
  sonar_dir:
    type: string
    default: "/tmp/cache/sonar-scanner"
  cache_version:
    type: integer
    default: 1
steps:
  - restore_cache:
      keys:
        - v<<parameters.cache_version>>-sonar-scanner-<< parameters.sonar_version >>
  - run:
      environment:
        SONAR_VERSION: <<parameters.sonar_version>>
        SONAR_DIR: << parameters.sonar_dir >>
      name: Execute sonar
      command: <<include(scripts/sonar.sh)>>
  - save_cache:
      key: v<<parameters.cache_version>>-sonar-scanner-<< parameters.sonar_version >>
      paths: ~/.sonar
