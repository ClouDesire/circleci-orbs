---
description: "Setup steps"
parameters:
  sonar_version:
    type: string
    default: "3.7.0.1746"
  sonar_dir:
    type: string
    default: "/tmp/cache/sonar-scanner"
  sonar_opts:
    type: string
    default: ""
  sonar_sources:
    type: string
    default: ""
  cache_version:
    type: integer
    default: 1
steps:
  - restore_cache:
      keys:
        - sonarscanner-<< parameters.sonar_version >>_v<<parameters.cache_version>>
  - run:
      environment:
        SONAR_VERSION: <<parameters.sonar_version>>
        SONAR_DIR: << parameters.sonar_dir >>
        SONAR_OPTS: << parameters.sonar_opts >>
        SONAR_SOURCES: << parameters.sonar_sources >>
      name: Execute sonar
      command: <<include(scripts/sonar.sh)>>
  - save_cache:
      key: sonarscanner-<< parameters.sonar_version >>_v<<parameters.cache_version>>
      paths: ~/.sonar
